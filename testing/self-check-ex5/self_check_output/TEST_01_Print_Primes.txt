.data
msg_div_zero: .asciiz "Illegal Division By Zero"
msg_null_ptr: .asciiz "Invalid Pointer Dereference"
msg_bounds: .asciiz "Access Violation"
start_8: .word 0
i_8: .word 0
j_9: .word 0
end_9: .word 0
p_7: .word 0
p_10: .word 0

.text
.globl main

main:
    j __user_main    # Jump to main function
IsPrime:
    # Function prologue
    addi $sp, $sp, -8    # allocate stack frame
    sw $ra, 4($sp)    # save return address
    sw $fp, 0($sp)    # save frame pointer
    addi $fp, $sp, 8    # set new frame pointer

    # Allocate p_7
    # Allocate p_7

    # Allocate i_8
    # Allocate i_8

    # Temp_0 := 2
    li $t0, 2

    # i_8 := Temp_0
    sw $t0, i_8

    # Allocate j_9
    # Allocate j_9

    # Temp_1 := 2
    li $t0, 2

    # j_9 := Temp_1
    sw $t0, j_9

Label_1_start:

    # Temp_3 := i_8
    lw $t0, i_8

    # Temp_4 := p_7
    lw $t1, p_7

    # Temp_2 := Temp_3 < Temp_4
    slt $t0, $t0, $t1

    # JumpIfEqToZero Temp_2 Label_0_end
    beq $t0, $zero, Label_0_end

    # Temp_5 := 2
    li $t0, 2

    # j_9 := Temp_5
    sw $t0, j_9

Label_3_start:

    # Temp_7 := j_9
    lw $t0, j_9

    # Temp_8 := p_7
    lw $t1, p_7

    # Temp_6 := Temp_7 < Temp_8
    slt $t0, $t0, $t1

    # JumpIfEqToZero Temp_6 Label_2_end
    beq $t0, $zero, Label_2_end

    # Temp_11 := i_8
    lw $t0, i_8

    # Temp_12 := j_9
    lw $t1, j_9

    # Temp_10 := Temp_11 * Temp_12
    # Saturated multiplication
    mul $t0, $t0, $t1
    li $t9, 32767
    bgt $t0, $t9, saturate_mul_max_0
    li $t9, -32768
    blt $t0, $t9, saturate_mul_min_1
    j saturate_mul_done_2
saturate_mul_max_0:
    li $t0, 32767
    j saturate_mul_done_2
saturate_mul_min_1:
    li $t0, -32768
saturate_mul_done_2:

    # Temp_13 := p_7
    lw $t1, p_7

    # Temp_9 := Temp_10 == Temp_13
    move $t8, $t0
    li $t0, 0    # assume not equal
    bne $t8, $t1, eq_done_4
    li $t0, 1    # they are equal
eq_done_4:

    # JumpIfEqToZero Temp_9 Label_5_end
    beq $t0, $zero, Label_5_end

    # Temp_14 := 0
    li $t0, 0

    # RETURN Temp_14
    move $v0, $t0    # return value
    # Function epilogue
    lw $ra, 4($sp)    # restore return address
    lw $fp, 0($sp)    # restore frame pointer
    addi $sp, $sp, 8    # deallocate stack frame
    jr $ra

Label_5_end:

    # Temp_16 := j_9
    lw $t0, j_9

    # Temp_17 := 1
    li $t1, 1

    # Temp_15 := Temp_16 + Temp_17
    # Saturated addition
    add $t0, $t0, $t1
    li $t9, 32767
    bgt $t0, $t9, saturate_add_max_5
    li $t9, -32768
    blt $t0, $t9, saturate_add_min_6
    j saturate_add_done_7
saturate_add_max_5:
    li $t0, 32767
    j saturate_add_done_7
saturate_add_min_6:
    li $t0, -32768
saturate_add_done_7:

    # j_9 := Temp_15
    sw $t0, j_9

    # Jump Label_3_start
    j Label_3_start

Label_2_end:

    # Temp_19 := i_8
    lw $t1, i_8

    # Temp_20 := 1
    li $t0, 1

    # Temp_18 := Temp_19 + Temp_20
    # Saturated addition
    add $t0, $t1, $t0
    li $t9, 32767
    bgt $t0, $t9, saturate_add_max_8
    li $t9, -32768
    blt $t0, $t9, saturate_add_min_9
    j saturate_add_done_10
saturate_add_max_8:
    li $t0, 32767
    j saturate_add_done_10
saturate_add_min_9:
    li $t0, -32768
saturate_add_done_10:

    # i_8 := Temp_18
    sw $t0, i_8

    # Jump Label_1_start
    j Label_1_start

Label_0_end:

    # Temp_21 := 1
    li $t0, 1

    # RETURN Temp_21
    move $v0, $t0    # return value
    # Function epilogue
    lw $ra, 4($sp)    # restore return address
    lw $fp, 0($sp)    # restore frame pointer
    addi $sp, $sp, 8    # deallocate stack frame
    jr $ra

    # Implicit return for void function
    # Function epilogue
    lw $ra, 4($sp)    # restore return address
    lw $fp, 0($sp)    # restore frame pointer
    addi $sp, $sp, 8    # deallocate stack frame
    jr $ra

PrintPrimes:
    # Function prologue
    addi $sp, $sp, -8    # allocate stack frame
    sw $ra, 4($sp)    # save return address
    sw $fp, 0($sp)    # save frame pointer
    addi $fp, $sp, 8    # set new frame pointer

    # Allocate end_9
    # Allocate end_9

    # Allocate start_8
    # Allocate start_8

    # Allocate p_10
    # Allocate p_10

    # Temp_22 := start_8
    lw $t0, start_8

    # p_10 := Temp_22
    sw $t0, p_10

Label_7_start:

    # Temp_24 := p_10
    lw $t1, p_10

    # Temp_26 := end_9
    lw $t2, end_9

    # Temp_27 := 1
    li $t0, 1

    # Temp_25 := Temp_26 + Temp_27
    # Saturated addition
    add $t0, $t2, $t0
    li $t9, 32767
    bgt $t0, $t9, saturate_add_max_11
    li $t9, -32768
    blt $t0, $t9, saturate_add_min_12
    j saturate_add_done_13
saturate_add_max_11:
    li $t0, 32767
    j saturate_add_done_13
saturate_add_min_12:
    li $t0, -32768
saturate_add_done_13:

    # Temp_23 := Temp_24 < Temp_25
    slt $t0, $t1, $t0

    # JumpIfEqToZero Temp_23 Label_6_end
    beq $t0, $zero, Label_6_end

    # Temp_28 := p_10
    lw $t0, p_10

    # p_7 := Temp_28
    sw $t0, p_7

    # Temp_29 := IsPrime()
    # Save caller-saved registers
    addi $sp, $sp, -40    # allocate space for $t0-$t9
    sw $t0, 0($sp)
    sw $t1, 4($sp)
    sw $t2, 8($sp)
    sw $t3, 12($sp)
    sw $t4, 16($sp)
    sw $t5, 20($sp)
    sw $t6, 24($sp)
    sw $t7, 28($sp)
    sw $t8, 32($sp)
    sw $t9, 36($sp)
    jal IsPrime
    move $t0, $v0    # save return value
    # Restore caller-saved registers
    lw $t1, 4($sp)
    lw $t2, 8($sp)
    lw $t3, 12($sp)
    lw $t4, 16($sp)
    lw $t5, 20($sp)
    lw $t6, 24($sp)
    lw $t7, 28($sp)
    lw $t8, 32($sp)
    lw $t9, 36($sp)
    addi $sp, $sp, 40    # deallocate register save area

    # JumpIfEqToZero Temp_29 Label_9_end
    beq $t0, $zero, Label_9_end

    # Temp_30 := p_10
    lw $t0, p_10

    # p_10 := Temp_30
    sw $t0, p_10

    # Temp_31 := PrintInt()
    # Save caller-saved registers
    addi $sp, $sp, -40    # allocate space for $t0-$t9
    sw $t0, 0($sp)
    sw $t1, 4($sp)
    sw $t2, 8($sp)
    sw $t3, 12($sp)
    sw $t4, 16($sp)
    sw $t5, 20($sp)
    sw $t6, 24($sp)
    sw $t7, 28($sp)
    sw $t8, 32($sp)
    sw $t9, 36($sp)
    jal PrintInt
    move $t0, $v0    # save return value
    # Restore caller-saved registers
    lw $t1, 4($sp)
    lw $t2, 8($sp)
    lw $t3, 12($sp)
    lw $t4, 16($sp)
    lw $t5, 20($sp)
    lw $t6, 24($sp)
    lw $t7, 28($sp)
    lw $t8, 32($sp)
    lw $t9, 36($sp)
    addi $sp, $sp, 40    # deallocate register save area

Label_9_end:

    # Temp_33 := p_10
    lw $t0, p_10

    # Temp_34 := 1
    li $t1, 1

    # Temp_32 := Temp_33 + Temp_34
    # Saturated addition
    add $t0, $t0, $t1
    li $t9, 32767
    bgt $t0, $t9, saturate_add_max_14
    li $t9, -32768
    blt $t0, $t9, saturate_add_min_15
    j saturate_add_done_16
saturate_add_max_14:
    li $t0, 32767
    j saturate_add_done_16
saturate_add_min_15:
    li $t0, -32768
saturate_add_done_16:

    # p_10 := Temp_32
    sw $t0, p_10

    # Jump Label_7_start
    j Label_7_start

Label_6_end:

    # Implicit return for void function
    # Function epilogue
    lw $ra, 4($sp)    # restore return address
    lw $fp, 0($sp)    # restore frame pointer
    addi $sp, $sp, 8    # deallocate stack frame
    jr $ra

__user_main:
    # Function prologue
    addi $sp, $sp, -8    # allocate stack frame
    sw $ra, 4($sp)    # save return address
    sw $fp, 0($sp)    # save frame pointer
    addi $fp, $sp, 8    # set new frame pointer

    # Temp_35 := 100
    li $t0, 100

    # end_9 := Temp_35
    sw $t0, end_9

    # Temp_36 := 2
    li $t0, 2

    # start_8 := Temp_36
    # Save start_8 before store (recursive call ahead)
    addi $sp, $sp, -4    # allocate space
    lw $t8, start_8    # load current value
    sw $t8, 0($sp)    # save on stack
    sw $t0, start_8

    # Temp_37 := PrintPrimes()
    # Save caller-saved registers
    addi $sp, $sp, -40    # allocate space for $t0-$t9
    sw $t0, 0($sp)
    sw $t1, 4($sp)
    sw $t2, 8($sp)
    sw $t3, 12($sp)
    sw $t4, 16($sp)
    sw $t5, 20($sp)
    sw $t6, 24($sp)
    sw $t7, 28($sp)
    sw $t8, 32($sp)
    sw $t9, 36($sp)
    jal PrintPrimes
    move $t0, $v0    # save return value
    # Restore caller-saved registers
    lw $t1, 4($sp)
    lw $t2, 8($sp)
    lw $t3, 12($sp)
    lw $t4, 16($sp)
    lw $t5, 20($sp)
    lw $t6, 24($sp)
    lw $t7, 28($sp)
    lw $t8, 32($sp)
    lw $t9, 36($sp)
    addi $sp, $sp, 40    # deallocate register save area
    # Restore start_8 after call (from pre-store save)
    lw $t8, 0($sp)    # load saved value
    sw $t8, start_8    # restore global
    addi $sp, $sp, 4    # deallocate global save space

    # Exit program
    li $v0, 10
    syscall

error_div_by_zero:
    la $a0, msg_div_zero
    li $v0, 4
    syscall
    li $v0, 10
    syscall

error_null_pointer:
    la $a0, msg_null_ptr
    li $v0, 4
    syscall
    li $v0, 10
    syscall

error_bounds:
    la $a0, msg_bounds
    li $v0, 4
    syscall
    li $v0, 10
    syscall

PrintInt:
    # Print integer (expects value in p_10 variable)
    lw $a0, p_10    # load value to print
    li $v0, 1    # syscall: print_int
    syscall
    li $a0, 32    # print space
    li $v0, 11    # syscall: print_char
    syscall
    jr $ra    # return

PrintString:
    # Print string (expects value in p_10 variable)
    lw $a0, p_10    # load string address to print
    li $v0, 4    # syscall: print_string
    syscall
    jr $ra    # return

# Program exit
    li $v0, 10
    syscall
