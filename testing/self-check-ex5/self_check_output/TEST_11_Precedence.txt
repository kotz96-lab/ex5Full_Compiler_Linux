.data
msg_div_zero: .asciiz "Illegal Division By Zero"
msg_null_ptr: .asciiz "Invalid Pointer Dereference"
msg_bounds: .asciiz "Access Violation"
p_10: .word 0

.text
.globl main

main:
    j __user_main    # Jump to main function
__user_main:
    # Function prologue
    addi $sp, $sp, -8    # allocate stack frame
    sw $ra, 4($sp)    # save return address
    sw $fp, 0($sp)    # save frame pointer
    addi $fp, $sp, 8    # set new frame pointer

    # Temp_1 := 1
    li $t2, 1

    # Temp_3 := 2
    li $t1, 2

    # Temp_4 := 3
    li $t0, 3

    # Temp_2 := Temp_3 * Temp_4
    # Saturated multiplication
    mul $t0, $t1, $t0
    li $t9, 32767
    bgt $t0, $t9, saturate_mul_max_0
    li $t9, -32768
    blt $t0, $t9, saturate_mul_min_1
    j saturate_mul_done_2
saturate_mul_max_0:
    li $t0, 32767
    j saturate_mul_done_2
saturate_mul_min_1:
    li $t0, -32768
saturate_mul_done_2:

    # Temp_0 := Temp_1 + Temp_2
    # Saturated addition
    add $t0, $t2, $t0
    li $t9, 32767
    bgt $t0, $t9, saturate_add_max_3
    li $t9, -32768
    blt $t0, $t9, saturate_add_min_4
    j saturate_add_done_5
saturate_add_max_3:
    li $t0, 32767
    j saturate_add_done_5
saturate_add_min_4:
    li $t0, -32768
saturate_add_done_5:

    # p_10 := Temp_0
    sw $t0, p_10

    # Temp_5 := PrintInt()
    # Save caller-saved registers
    addi $sp, $sp, -40    # allocate space for $t0-$t9
    sw $t0, 0($sp)
    sw $t1, 4($sp)
    sw $t2, 8($sp)
    sw $t3, 12($sp)
    sw $t4, 16($sp)
    sw $t5, 20($sp)
    sw $t6, 24($sp)
    sw $t7, 28($sp)
    sw $t8, 32($sp)
    sw $t9, 36($sp)
    jal PrintInt
    move $t0, $v0    # save return value
    # Restore caller-saved registers
    lw $t1, 4($sp)
    lw $t2, 8($sp)
    lw $t3, 12($sp)
    lw $t4, 16($sp)
    lw $t5, 20($sp)
    lw $t6, 24($sp)
    lw $t7, 28($sp)
    lw $t8, 32($sp)
    lw $t9, 36($sp)
    addi $sp, $sp, 40    # deallocate register save area

    # Temp_8 := 3
    li $t0, 3

    # Temp_9 := 1
    li $t1, 1

    # Temp_7 := Temp_8 * Temp_9
    # Saturated multiplication
    mul $t0, $t0, $t1
    li $t9, 32767
    bgt $t0, $t9, saturate_mul_max_6
    li $t9, -32768
    blt $t0, $t9, saturate_mul_min_7
    j saturate_mul_done_8
saturate_mul_max_6:
    li $t0, 32767
    j saturate_mul_done_8
saturate_mul_min_7:
    li $t0, -32768
saturate_mul_done_8:

    # Temp_10 := 1
    li $t1, 1

    # Temp_6 := Temp_7 + Temp_10
    # Saturated addition
    add $t0, $t0, $t1
    li $t9, 32767
    bgt $t0, $t9, saturate_add_max_9
    li $t9, -32768
    blt $t0, $t9, saturate_add_min_10
    j saturate_add_done_11
saturate_add_max_9:
    li $t0, 32767
    j saturate_add_done_11
saturate_add_min_10:
    li $t0, -32768
saturate_add_done_11:

    # p_10 := Temp_6
    sw $t0, p_10

    # Temp_11 := PrintInt()
    # Save caller-saved registers
    addi $sp, $sp, -40    # allocate space for $t0-$t9
    sw $t0, 0($sp)
    sw $t1, 4($sp)
    sw $t2, 8($sp)
    sw $t3, 12($sp)
    sw $t4, 16($sp)
    sw $t5, 20($sp)
    sw $t6, 24($sp)
    sw $t7, 28($sp)
    sw $t8, 32($sp)
    sw $t9, 36($sp)
    jal PrintInt
    move $t0, $v0    # save return value
    # Restore caller-saved registers
    lw $t1, 4($sp)
    lw $t2, 8($sp)
    lw $t3, 12($sp)
    lw $t4, 16($sp)
    lw $t5, 20($sp)
    lw $t6, 24($sp)
    lw $t7, 28($sp)
    lw $t8, 32($sp)
    lw $t9, 36($sp)
    addi $sp, $sp, 40    # deallocate register save area

    # Temp_14 := 3
    li $t0, 3

    # Temp_15 := 2
    li $t1, 2

    # Temp_13 := Temp_14 * Temp_15
    # Saturated multiplication
    mul $t0, $t0, $t1
    li $t9, 32767
    bgt $t0, $t9, saturate_mul_max_12
    li $t9, -32768
    blt $t0, $t9, saturate_mul_min_13
    j saturate_mul_done_14
saturate_mul_max_12:
    li $t0, 32767
    j saturate_mul_done_14
saturate_mul_min_13:
    li $t0, -32768
saturate_mul_done_14:

    # Temp_16 := 6
    li $t1, 6

    # Temp_12 := Temp_13 / Temp_16
    # Check division by zero
    beq $t1, $zero, error_div_by_zero
    # Saturated division
    div $t0, $t0, $t1
    li $t9, 32767
    bgt $t0, $t9, saturate_div_max_15
    li $t9, -32768
    blt $t0, $t9, saturate_div_min_16
    j saturate_div_done_17
saturate_div_max_15:
    li $t0, 32767
    j saturate_div_done_17
saturate_div_min_16:
    li $t0, -32768
saturate_div_done_17:

    # p_10 := Temp_12
    sw $t0, p_10

    # Temp_17 := PrintInt()
    # Save caller-saved registers
    addi $sp, $sp, -40    # allocate space for $t0-$t9
    sw $t0, 0($sp)
    sw $t1, 4($sp)
    sw $t2, 8($sp)
    sw $t3, 12($sp)
    sw $t4, 16($sp)
    sw $t5, 20($sp)
    sw $t6, 24($sp)
    sw $t7, 28($sp)
    sw $t8, 32($sp)
    sw $t9, 36($sp)
    jal PrintInt
    move $t0, $v0    # save return value
    # Restore caller-saved registers
    lw $t1, 4($sp)
    lw $t2, 8($sp)
    lw $t3, 12($sp)
    lw $t4, 16($sp)
    lw $t5, 20($sp)
    lw $t6, 24($sp)
    lw $t7, 28($sp)
    lw $t8, 32($sp)
    lw $t9, 36($sp)
    addi $sp, $sp, 40    # deallocate register save area

    # Temp_20 := 6
    li $t0, 6

    # Temp_21 := 6
    li $t1, 6

    # Temp_19 := Temp_20 / Temp_21
    # Check division by zero
    beq $t1, $zero, error_div_by_zero
    # Saturated division
    div $t1, $t0, $t1
    li $t9, 32767
    bgt $t1, $t9, saturate_div_max_18
    li $t9, -32768
    blt $t1, $t9, saturate_div_min_19
    j saturate_div_done_20
saturate_div_max_18:
    li $t1, 32767
    j saturate_div_done_20
saturate_div_min_19:
    li $t1, -32768
saturate_div_done_20:

    # Temp_22 := 3
    li $t0, 3

    # Temp_18 := Temp_19 * Temp_22
    # Saturated multiplication
    mul $t0, $t1, $t0
    li $t9, 32767
    bgt $t0, $t9, saturate_mul_max_21
    li $t9, -32768
    blt $t0, $t9, saturate_mul_min_22
    j saturate_mul_done_23
saturate_mul_max_21:
    li $t0, 32767
    j saturate_mul_done_23
saturate_mul_min_22:
    li $t0, -32768
saturate_mul_done_23:

    # p_10 := Temp_18
    sw $t0, p_10

    # Temp_23 := PrintInt()
    # Save caller-saved registers
    addi $sp, $sp, -40    # allocate space for $t0-$t9
    sw $t0, 0($sp)
    sw $t1, 4($sp)
    sw $t2, 8($sp)
    sw $t3, 12($sp)
    sw $t4, 16($sp)
    sw $t5, 20($sp)
    sw $t6, 24($sp)
    sw $t7, 28($sp)
    sw $t8, 32($sp)
    sw $t9, 36($sp)
    jal PrintInt
    move $t0, $v0    # save return value
    # Restore caller-saved registers
    lw $t1, 4($sp)
    lw $t2, 8($sp)
    lw $t3, 12($sp)
    lw $t4, 16($sp)
    lw $t5, 20($sp)
    lw $t6, 24($sp)
    lw $t7, 28($sp)
    lw $t8, 32($sp)
    lw $t9, 36($sp)
    addi $sp, $sp, 40    # deallocate register save area

    # Temp_26 := 3
    li $t1, 3

    # Temp_27 := 2
    li $t0, 2

    # Temp_25 := Temp_26 - Temp_27
    # Saturated subtraction
    sub $t1, $t1, $t0
    li $t9, 32767
    bgt $t1, $t9, saturate_sub_max_24
    li $t9, -32768
    blt $t1, $t9, saturate_sub_min_25
    j saturate_sub_done_26
saturate_sub_max_24:
    li $t1, 32767
    j saturate_sub_done_26
saturate_sub_min_25:
    li $t1, -32768
saturate_sub_done_26:

    # Temp_28 := 2
    li $t0, 2

    # Temp_24 := Temp_25 - Temp_28
    # Saturated subtraction
    sub $t0, $t1, $t0
    li $t9, 32767
    bgt $t0, $t9, saturate_sub_max_27
    li $t9, -32768
    blt $t0, $t9, saturate_sub_min_28
    j saturate_sub_done_29
saturate_sub_max_27:
    li $t0, 32767
    j saturate_sub_done_29
saturate_sub_min_28:
    li $t0, -32768
saturate_sub_done_29:

    # p_10 := Temp_24
    sw $t0, p_10

    # Temp_29 := PrintInt()
    # Save caller-saved registers
    addi $sp, $sp, -40    # allocate space for $t0-$t9
    sw $t0, 0($sp)
    sw $t1, 4($sp)
    sw $t2, 8($sp)
    sw $t3, 12($sp)
    sw $t4, 16($sp)
    sw $t5, 20($sp)
    sw $t6, 24($sp)
    sw $t7, 28($sp)
    sw $t8, 32($sp)
    sw $t9, 36($sp)
    jal PrintInt
    move $t0, $v0    # save return value
    # Restore caller-saved registers
    lw $t1, 4($sp)
    lw $t2, 8($sp)
    lw $t3, 12($sp)
    lw $t4, 16($sp)
    lw $t5, 20($sp)
    lw $t6, 24($sp)
    lw $t7, 28($sp)
    lw $t8, 32($sp)
    lw $t9, 36($sp)
    addi $sp, $sp, 40    # deallocate register save area

    # Exit program
    li $v0, 10
    syscall

error_div_by_zero:
    la $a0, msg_div_zero
    li $v0, 4
    syscall
    li $v0, 10
    syscall

error_null_pointer:
    la $a0, msg_null_ptr
    li $v0, 4
    syscall
    li $v0, 10
    syscall

error_bounds:
    la $a0, msg_bounds
    li $v0, 4
    syscall
    li $v0, 10
    syscall

PrintInt:
    # Print integer (expects value in p_10 variable)
    lw $a0, p_10    # load value to print
    li $v0, 1    # syscall: print_int
    syscall
    li $a0, 32    # print space
    li $v0, 11    # syscall: print_char
    syscall
    jr $ra    # return

PrintString:
    # Print string (expects value in p_10 variable)
    lw $a0, p_10    # load string address to print
    li $v0, 4    # syscall: print_string
    syscall
    jr $ra    # return

# Program exit
    li $v0, 10
    syscall
