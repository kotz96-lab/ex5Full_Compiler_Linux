.data
msg_div_zero: .asciiz "Illegal Division By Zero"
msg_null_ptr: .asciiz "Invalid Pointer Dereference"
msg_bounds: .asciiz "Access Violation"
i_10: .word 0
j_11: .word 0
min_12: .word 0
size_9: .word 0
arr_8: .word 0
minIndex_13: .word 0
arr_9: .word 0
p_10: .word 0
temp_14: .word 0

.text
.globl main

main:
    j __user_main    # Jump to main function
BubbleSort:

    # Allocate size_9
    # Allocate size_9

    # Allocate arr_8
    # Allocate arr_8

    # Allocate i_10
    # Allocate i_10

    # Temp_0 := 0
    li $t0, 0

    # i_10 := Temp_0
    sw $t0, i_10

    # Allocate j_11
    # Allocate j_11

    # Temp_1 := 0
    li $t0, 0

    # j_11 := Temp_1
    sw $t0, j_11

    # Allocate min_12
    # Allocate min_12

    # Temp_2 := 32767
    li $t0, 32767

    # min_12 := Temp_2
    sw $t0, min_12

    # Allocate minIndex_13
    # Allocate minIndex_13

    # Temp_3 := 1
    li $t0, 1

    # Temp_4 := -Temp_3
    # Saturated negation
    li $t9, -32768
    beq $t0, $t9, saturate_neg_0
    neg $t4, $t0
    j saturate_neg_done_1
saturate_neg_0:
    li $t4, 32767
saturate_neg_done_1:

    # minIndex_13 := Temp_4
    sw $t4, minIndex_13

    # Allocate temp_14
    # Allocate temp_14

    # Temp_5 := 0
    li $t0, 0

    # temp_14 := Temp_5
    sw $t0, temp_14

Label_1_start:

    # Temp_7 := i_10
    lw $t0, i_10

    # Temp_8 := size_9
    lw $t4, size_9

    # Temp_6 := Temp_7 < Temp_8
    slt $t0, $t0, $t4

    # JumpIfEqToZero Temp_6 Label_0_end
    beq $t0, $zero, Label_0_end

    # Temp_9 := i_10
    lw $t0, i_10

    # j_11 := Temp_9
    sw $t0, j_11

    # Temp_10 := 32767
    li $t0, 32767

    # min_12 := Temp_10
    sw $t0, min_12

Label_3_start:

    # Temp_12 := j_11
    lw $t4, j_11

    # Temp_13 := size_9
    lw $t0, size_9

    # Temp_11 := Temp_12 < Temp_13
    slt $t0, $t4, $t0

    # JumpIfEqToZero Temp_11 Label_2_end
    beq $t0, $zero, Label_2_end

    # Temp_15 := arr_8
    lw $t0, arr_8

    # Temp_16 := j_11
    lw $t4, j_11

    # Temp_17 := ARRAY_ACCESS(Temp_15[Temp_16], elemSize=4)
    # Check array bounds
    beq $t0, $zero, error_null_pointer
    bltz $t4, error_bounds
    lw $s0, 0($t0)    # load array length
    bge $t4, $s0, error_bounds
    sll $s0, $t4, 2    # index * 4
    addi $s0, $s0, 4    # + 4 (skip length)
    add $s0, $t0, $s0
    lw $t0, 0($s0)

    # Temp_18 := min_12
    lw $t4, min_12

    # Temp_14 := Temp_17 < Temp_18
    slt $t0, $t0, $t4

    # JumpIfEqToZero Temp_14 Label_5_end
    beq $t0, $zero, Label_5_end

    # Temp_19 := arr_8
    lw $t4, arr_8

    # Temp_20 := j_11
    lw $t0, j_11

    # Temp_21 := ARRAY_ACCESS(Temp_19[Temp_20], elemSize=4)
    # Check array bounds
    beq $t4, $zero, error_null_pointer
    bltz $t0, error_bounds
    lw $s0, 0($t4)    # load array length
    bge $t0, $s0, error_bounds
    sll $s0, $t0, 2    # index * 4
    addi $s0, $s0, 4    # + 4 (skip length)
    add $s0, $t4, $s0
    lw $t0, 0($s0)

    # min_12 := Temp_21
    sw $t0, min_12

    # Temp_22 := j_11
    lw $t0, j_11

    # minIndex_13 := Temp_22
    sw $t0, minIndex_13

Label_5_end:

    # Temp_24 := j_11
    lw $t0, j_11

    # Temp_25 := 1
    li $t4, 1

    # Temp_23 := Temp_24 + Temp_25
    # Saturated addition
    add $t0, $t0, $t4
    li $t9, 32767
    bgt $t0, $t9, saturate_add_max_2
    li $t9, -32768
    blt $t0, $t9, saturate_add_min_3
    j saturate_add_done_4
saturate_add_max_2:
    li $t0, 32767
    j saturate_add_done_4
saturate_add_min_3:
    li $t0, -32768
saturate_add_done_4:

    # j_11 := Temp_23
    sw $t0, j_11

    # Jump Label_3_start
    j Label_3_start

Label_2_end:

    # Temp_26 := arr_8
    lw $t4, arr_8

    # Temp_27 := i_10
    lw $t0, i_10

    # Temp_28 := ARRAY_ACCESS(Temp_26[Temp_27], elemSize=4)
    # Check array bounds
    beq $t4, $zero, error_null_pointer
    bltz $t0, error_bounds
    lw $s0, 0($t4)    # load array length
    bge $t0, $s0, error_bounds
    sll $s0, $t0, 2    # index * 4
    addi $s0, $s0, 4    # + 4 (skip length)
    add $s0, $t4, $s0
    lw $t0, 0($s0)

    # temp_14 := Temp_28
    sw $t0, temp_14

    # Temp_29 := min_12
    lw $t5, min_12

    # Temp_30 := arr_8
    lw $t4, arr_8

    # Temp_31 := i_10
    lw $t0, i_10

    # ARRAY_STORE(Temp_30[Temp_31], Temp_29, elemSize=4)
    # Check array bounds
    beq $t4, $zero, error_null_pointer
    bltz $t0, error_bounds
    lw $s0, 0($t4)    # load array length
    bge $t0, $s0, error_bounds
    sll $s0, $t0, 2
    addi $s0, $s0, 4
    add $s0, $t4, $s0
    sw $t5, 0($s0)

    # Temp_32 := temp_14
    lw $t4, temp_14

    # Temp_33 := arr_8
    lw $t5, arr_8

    # Temp_34 := minIndex_13
    lw $t0, minIndex_13

    # ARRAY_STORE(Temp_33[Temp_34], Temp_32, elemSize=4)
    # Check array bounds
    beq $t5, $zero, error_null_pointer
    bltz $t0, error_bounds
    lw $s0, 0($t5)    # load array length
    bge $t0, $s0, error_bounds
    sll $s0, $t0, 2
    addi $s0, $s0, 4
    add $s0, $t5, $s0
    sw $t4, 0($s0)

    # Temp_36 := i_10
    lw $t4, i_10

    # Temp_37 := 1
    li $t0, 1

    # Temp_35 := Temp_36 + Temp_37
    # Saturated addition
    add $t0, $t4, $t0
    li $t9, 32767
    bgt $t0, $t9, saturate_add_max_5
    li $t9, -32768
    blt $t0, $t9, saturate_add_min_6
    j saturate_add_done_7
saturate_add_max_5:
    li $t0, 32767
    j saturate_add_done_7
saturate_add_min_6:
    li $t0, -32768
saturate_add_done_7:

    # i_10 := Temp_35
    sw $t0, i_10

    # Jump Label_1_start
    j Label_1_start

Label_0_end:

__user_main:
    # Function prologue
    addi $sp, $sp, -8    # allocate stack frame
    sw $ra, 4($sp)    # save return address
    sw $fp, 0($sp)    # save frame pointer
    addi $fp, $sp, 8    # set new frame pointer

    # Allocate arr_9
    # Allocate arr_9

    # Temp_39 := 7
    li $t0, 7

    # Temp_38 := NEW_ARRAY(int[Temp_39], elemSize=4)
    # Allocate array
    li $s0, 4
    mul $s0, $t0, $s0    # size * elemSize
    addi $a0, $s0, 4    # +4 for length field
    li $v0, 9    # malloc
    syscall
    sw $t0, 0($v0)    # store length
    move $t0, $v0

    # arr_9 := Temp_38
    sw $t0, arr_9

    # Temp_40 := 34
    li $t0, 34

    # Temp_41 := arr_9
    lw $t4, arr_9

    # Temp_42 := 0
    li $t5, 0

    # ARRAY_STORE(Temp_41[Temp_42], Temp_40, elemSize=4)
    # Check array bounds
    beq $t4, $zero, error_null_pointer
    bltz $t5, error_bounds
    lw $s0, 0($t4)    # load array length
    bge $t5, $s0, error_bounds
    sll $s0, $t5, 2
    addi $s0, $s0, 4
    add $s0, $t4, $s0
    sw $t0, 0($s0)

    # Temp_43 := 12
    li $t4, 12

    # Temp_44 := arr_9
    lw $t5, arr_9

    # Temp_45 := 1
    li $t0, 1

    # ARRAY_STORE(Temp_44[Temp_45], Temp_43, elemSize=4)
    # Check array bounds
    beq $t5, $zero, error_null_pointer
    bltz $t0, error_bounds
    lw $s0, 0($t5)    # load array length
    bge $t0, $s0, error_bounds
    sll $s0, $t0, 2
    addi $s0, $s0, 4
    add $s0, $t5, $s0
    sw $t4, 0($s0)

    # Temp_46 := 600
    li $t0, 600

    # Temp_47 := -Temp_46
    # Saturated negation
    li $t9, -32768
    beq $t0, $t9, saturate_neg_8
    neg $t3, $t0
    j saturate_neg_done_9
saturate_neg_8:
    li $t3, 32767
saturate_neg_done_9:

    # Temp_48 := arr_9
    lw $t0, arr_9

    # Temp_49 := 2
    li $t4, 2

    # ARRAY_STORE(Temp_48[Temp_49], Temp_47, elemSize=4)
    # Check array bounds
    beq $t0, $zero, error_null_pointer
    bltz $t4, error_bounds
    lw $s0, 0($t0)    # load array length
    bge $t4, $s0, error_bounds
    sll $s0, $t4, 2
    addi $s0, $s0, 4
    add $s0, $t0, $s0
    sw $t3, 0($s0)

    # Temp_50 := 400
    li $t0, 400

    # Temp_51 := -Temp_50
    # Saturated negation
    li $t9, -32768
    beq $t0, $t9, saturate_neg_10
    neg $t1, $t0
    j saturate_neg_done_11
saturate_neg_10:
    li $t1, 32767
saturate_neg_done_11:

    # Temp_52 := arr_9
    lw $t3, arr_9

    # Temp_53 := 3
    li $t0, 3

    # ARRAY_STORE(Temp_52[Temp_53], Temp_51, elemSize=4)
    # Check array bounds
    beq $t3, $zero, error_null_pointer
    bltz $t0, error_bounds
    lw $s0, 0($t3)    # load array length
    bge $t0, $s0, error_bounds
    sll $s0, $t0, 2
    addi $s0, $s0, 4
    add $s0, $t3, $s0
    sw $t1, 0($s0)

    # Temp_54 := 70
    li $t0, 70

    # Temp_55 := arr_9
    lw $t3, arr_9

    # Temp_56 := 4
    li $t1, 4

    # ARRAY_STORE(Temp_55[Temp_56], Temp_54, elemSize=4)
    # Check array bounds
    beq $t3, $zero, error_null_pointer
    bltz $t1, error_bounds
    lw $s0, 0($t3)    # load array length
    bge $t1, $s0, error_bounds
    sll $s0, $t1, 2
    addi $s0, $s0, 4
    add $s0, $t3, $s0
    sw $t0, 0($s0)

    # Temp_57 := 30
    li $t0, 30

    # Temp_58 := arr_9
    lw $t3, arr_9

    # Temp_59 := 5
    li $t1, 5

    # ARRAY_STORE(Temp_58[Temp_59], Temp_57, elemSize=4)
    # Check array bounds
    beq $t3, $zero, error_null_pointer
    bltz $t1, error_bounds
    lw $s0, 0($t3)    # load array length
    bge $t1, $s0, error_bounds
    sll $s0, $t1, 2
    addi $s0, $s0, 4
    add $s0, $t3, $s0
    sw $t0, 0($s0)

    # Temp_60 := 580
    li $t0, 580

    # Temp_61 := -Temp_60
    # Saturated negation
    li $t9, -32768
    beq $t0, $t9, saturate_neg_12
    neg $t2, $t0
    j saturate_neg_done_13
saturate_neg_12:
    li $t2, 32767
saturate_neg_done_13:

    # Temp_62 := arr_9
    lw $t0, arr_9

    # Temp_63 := 6
    li $t1, 6

    # ARRAY_STORE(Temp_62[Temp_63], Temp_61, elemSize=4)
    # Check array bounds
    beq $t0, $zero, error_null_pointer
    bltz $t1, error_bounds
    lw $s0, 0($t0)    # load array length
    bge $t1, $s0, error_bounds
    sll $s0, $t1, 2
    addi $s0, $s0, 4
    add $s0, $t0, $s0
    sw $t2, 0($s0)

    # Temp_64 := 7
    li $t0, 7

    # size_9 := Temp_64
    sw $t0, size_9

    # Temp_65 := arr_9
    lw $t0, arr_9

    # arr_8 := Temp_65
    # Save arr_8 before store (recursive call ahead)
    addi $sp, $sp, -4    # allocate space
    lw $t8, arr_8    # load current value
    sw $t8, 0($sp)    # save on stack
    sw $t0, arr_8

    # Temp_66 := BubbleSort()
    # Save caller-saved registers
    addi $sp, $sp, -40    # allocate space for $t0-$t9
    sw $t0, 0($sp)
    sw $t1, 4($sp)
    sw $t2, 8($sp)
    sw $t3, 12($sp)
    sw $t4, 16($sp)
    sw $t5, 20($sp)
    sw $t6, 24($sp)
    sw $t7, 28($sp)
    sw $t8, 32($sp)
    sw $t9, 36($sp)
    jal BubbleSort
    move $t0, $v0    # save return value
    # Restore caller-saved registers
    lw $t1, 4($sp)
    lw $t2, 8($sp)
    lw $t3, 12($sp)
    lw $t4, 16($sp)
    lw $t5, 20($sp)
    lw $t6, 24($sp)
    lw $t7, 28($sp)
    lw $t8, 32($sp)
    lw $t9, 36($sp)
    addi $sp, $sp, 40    # deallocate register save area
    # Restore arr_8 after call (from pre-store save)
    lw $t8, 0($sp)    # load saved value
    sw $t8, arr_8    # restore global
    addi $sp, $sp, 4    # deallocate global save space

    # Allocate i_10
    # Allocate i_10

    # Temp_67 := 0
    li $t0, 0

    # i_10 := Temp_67
    sw $t0, i_10

Label_7_start:

    # Temp_69 := i_10
    lw $t1, i_10

    # Temp_70 := 7
    li $t0, 7

    # Temp_68 := Temp_69 < Temp_70
    slt $t0, $t1, $t0

    # JumpIfEqToZero Temp_68 Label_6_end
    beq $t0, $zero, Label_6_end

    # Temp_71 := arr_9
    lw $t0, arr_9

    # Temp_72 := i_10
    lw $t1, i_10

    # Temp_73 := ARRAY_ACCESS(Temp_71[Temp_72], elemSize=4)
    # Check array bounds
    beq $t0, $zero, error_null_pointer
    bltz $t1, error_bounds
    lw $s0, 0($t0)    # load array length
    bge $t1, $s0, error_bounds
    sll $s0, $t1, 2    # index * 4
    addi $s0, $s0, 4    # + 4 (skip length)
    add $s0, $t0, $s0
    lw $t0, 0($s0)

    # p_10 := Temp_73
    sw $t0, p_10

    # Temp_74 := PrintInt()
    # Save caller-saved registers
    addi $sp, $sp, -40    # allocate space for $t0-$t9
    sw $t0, 0($sp)
    sw $t1, 4($sp)
    sw $t2, 8($sp)
    sw $t3, 12($sp)
    sw $t4, 16($sp)
    sw $t5, 20($sp)
    sw $t6, 24($sp)
    sw $t7, 28($sp)
    sw $t8, 32($sp)
    sw $t9, 36($sp)
    jal PrintInt
    move $t0, $v0    # save return value
    # Restore caller-saved registers
    lw $t1, 4($sp)
    lw $t2, 8($sp)
    lw $t3, 12($sp)
    lw $t4, 16($sp)
    lw $t5, 20($sp)
    lw $t6, 24($sp)
    lw $t7, 28($sp)
    lw $t8, 32($sp)
    lw $t9, 36($sp)
    addi $sp, $sp, 40    # deallocate register save area

    # Temp_76 := i_10
    lw $t0, i_10

    # Temp_77 := 1
    li $t1, 1

    # Temp_75 := Temp_76 + Temp_77
    # Saturated addition
    add $t0, $t0, $t1
    li $t9, 32767
    bgt $t0, $t9, saturate_add_max_14
    li $t9, -32768
    blt $t0, $t9, saturate_add_min_15
    j saturate_add_done_16
saturate_add_max_14:
    li $t0, 32767
    j saturate_add_done_16
saturate_add_min_15:
    li $t0, -32768
saturate_add_done_16:

    # i_10 := Temp_75
    sw $t0, i_10

    # Jump Label_7_start
    j Label_7_start

Label_6_end:

    # Exit program
    li $v0, 10
    syscall

error_div_by_zero:
    la $a0, msg_div_zero
    li $v0, 4
    syscall
    li $v0, 10
    syscall

error_null_pointer:
    la $a0, msg_null_ptr
    li $v0, 4
    syscall
    li $v0, 10
    syscall

error_bounds:
    la $a0, msg_bounds
    li $v0, 4
    syscall
    li $v0, 10
    syscall

PrintInt:
    # Print integer (expects value in p_10 variable)
    lw $a0, p_10    # load value to print
    li $v0, 1    # syscall: print_int
    syscall
    li $a0, 32    # print space
    li $v0, 11    # syscall: print_char
    syscall
    jr $ra    # return

PrintString:
    # Print string (expects value in p_10 variable)
    lw $a0, p_10    # load string address to print
    li $v0, 4    # syscall: print_string
    syscall
    jr $ra    # return

# Program exit
    li $v0, 10
    syscall
